## reset key bindings first
run-shell "~/.config/tmux/get_default_tmux.zsh"

if-shell "[[ -f ~/.tmux.zsh.reset.conf ]]" {
# default key bindings found - reset to default key bindings first
    unbind-key -a
    source-file ~/.tmux.zsh.reset.conf
}

## Set prefix key to Ctrl-A as it is more convenient
unbind C-b
set-option -g prefix C-a
bind-key -N "Send the prefix key" C-a send-prefix

set -g default-terminal "screen-256color"
set -g mouse on

set-option -sg escape-time 10
set-option -g detach-on-destroy  off
set-option -g set-clipboard on
set-option -g terminal-overrides ",screen-256color:RGB"
set-option -sa terminal-features ",screen-256color:RGB"


set -g status-position top
set -g pane-active-border-style 'fg=magenta,bg=default'
set -g pane-border-style 'fg=brightblack,bg=default'

# Increase scrollback buffer size from 2000 to 50000 lines
set-option -g history-limit 100000

setw -g mode-keys vi

# Count panes from 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber window index number on delete
set-option -g renumber-windows on

# Remap horizontal and vertical split panes so that it is easier to remember
bind -N "Split window vertically" v split-window -v
bind -N "Split window horizontally" h split-window -h
unbind '"'
unbind %

bind -N "Start a new session" S new-session

bind -N "Join current pane to another window" @ command-prompt -T window-target -p "Join pane #P to which window? " { join-pane -t ":%%" }

# Faster next and previous window
# Easier and faster switching between next/prev window
bind -N "Select the previous window" C-p previous-window
bind -N "Select the next window" C-n next-window

bind -N "Switch to next session and kill current session" C-x \
  confirm-before -p 'kill-session #S? (y/n)' "rename-session 'DEADSESSION' \; switch-client -n \; kill-session -t 'DEADSESSION' "

# reload config file
bind -N "Re-run tmux configuration file" R source-file ~/.config/tmux/tmux.conf

set-environment -g TMUX_PLUGIN_MANAGER_PATH "~/.tmux/plugins"
## catppuccin theme requires nerd font - I am using MesloGLDZ Nerd Font Mono
## Installed via: 
##    brew install --cask homebrew/cask-fonts/font-fira-mono-nerd-font
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-boot 'on'
set -g @continuum-restore 'on'

#set -g @resurrect-strategy-nvim 'session'
# set -g @catppuccin_window_left_separator ""
# set -g @catppuccin_window_right_separator " "
# set -g @catppuccin_window_middle_separator " █"
# set -g @catppuccin_window_number_position "right"
# set -g @catppuccin_window_default_fill "number"
# set -g @catppuccin_window_default_text "#W"
# set -g @catppuccin_window_current_fill "number"
# set -g @catppuccin_window_current_text "#W#{?window_zoomed_flag,(),}"
# set -g @catppuccin_status_modules_right "directory meetings date_time"
# set -g @catppuccin_status_modules_left "session"
# set -g @catppuccin_status_left_separator  " "
# set -g @catppuccin_status_right_separator " "
# set -g @catppuccin_status_right_separator_inverse "no"
# set -g @catppuccin_status_fill "icon"
# set -g @catppuccin_status_connect_separator "no"
# set -g @catppuccin_directory_text "#{b:pane_current_path}"
# set -g @catppuccin_meetings_text "#($HOME/.config/tmux/scripts/cal.sh)"
# set -g @catppuccin_date_time_text "%H:%M"

## Config 1
# set -g @catppuccin_window_right_separator "█ "
# set -g @catppuccin_window_number_position "right"
# set -g @catppuccin_window_middle_separator " | "
# set -g @catppuccin_window_default_fill "none"
# set -g @catppuccin_window_current_fill "all"
# set -g @catppuccin_status_modules_right "application session user host date_time"
# set -g @catppuccin_status_left_separator "█"
# set -g @catppuccin_status_right_separator "█"
# set -g @catppuccin_date_time_text "%Y-%m-%d %H:%M:%S"

## Config 2
set -g @catppuccin_window_left_separator ""
set -g @catppuccin_window_right_separator " "
set -g @catppuccin_window_middle_separator " | "
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_default_fill "none"
set -g @catppuccin_window_default_text "#W:#{b:pane_current_path}"
set -g @catppuccin_window_current_fill "all"
set -g @catppuccin_window_current_text "#W:#{b:pane_current_path}"
set -g @catppuccin_status_modules_right "application session date_time"
set -g @catppuccin_status_left_separator  ""
set -g @catppuccin_status_right_separator " "
set -g @catppuccin_status_right_separator_inverse "yes"
set -g @catppuccin_status_fill "all"
set -g @catppuccin_status_connect_separator "no"
set -g @catppuccin_date_time_text "%Y-%m-%d %H:%M %p"

## Config 3
# set -g @catppuccin_window_left_separator ""
# set -g @catppuccin_window_right_separator " "
# set -g @catppuccin_window_middle_separator " █"
# set -g @catppuccin_window_number_position "right"
# set -g @catppuccin_window_default_fill "number"
# set -g @catppuccin_window_default_text "#W"
# set -g @catppuccin_window_current_fill "number"
# set -g @catppuccin_window_current_text "#W"
# set -g @catppuccin_status_modules_right "directory user host session"
# set -g @catppuccin_status_left_separator  " "
# set -g @catppuccin_status_right_separator ""
# set -g @catppuccin_status_right_separator_inverse "no"
# set -g @catppuccin_status_fill "icon"
# set -g @catppuccin_status_connect_separator "no"
# set -g @catppuccin_directory_text "#{pane_current_path}"

if-shell "tmux -f /dev/null -L temp start-server \;" {
} {
    if-shell "[[ $(uname) == 'Darwin' ]]" {
        set-environment -g PATH "/opt/homebrew/bin:/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin"
        set-environment PATH "/opt/homebrew/bin:/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin"
    }
}

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
run '~/.tmux/plugins/tmux-sensible/sensible.tmux'
run '~/.tmux/plugins/tmux-yank/yank.tmux'
run '~/.tmux/plugins/tmux-resurrect/resurrect.tmux'
run '~/.tmux/plugins/tmux-continuum/continuum.tmux'

